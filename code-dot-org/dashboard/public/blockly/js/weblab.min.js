webpackJsonp([21],{2965:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.blockly.weblab_locale,e.exports=t.default},2966:function(e,t,n){"use strict";function o(e){return{type:l.CHANGE_FULL_SCREEN_PREVIEW_ON,fullScreenPreviewOn:e}}function i(e){return{type:l.CHANGE_INSPECTOR_ON,inspectorOn:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ActionType=void 0,t.changeFullScreenPreviewOn=o,t.changeInspectorOn=i;var r=n(71),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(r),l=t.ActionType=s.makeEnum("CHANGE_FULL_SCREEN_PREVIEW_ON","CHANGE_INSPECTOR_ON")},3363:function(e,t,n){n(151),n(152),e.exports=n(3364)},3364:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var i=n(3365),r=o(i);(0,o(n(820)).default)().then(r.default)},3365:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e){e.skinsModule=d.default,e.isEditorless=!0,e.skinId="weblab";var t=new u.default;t.injectStudioApp((0,l.singleton)()),(0,s.default)(t,f.default,e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var r=n(853),s=o(r),l=n(597),a=n(3366),u=o(a),c=n(744),d=o(c),p=n(3369),f=o(p);e.exports=t.default},3366:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.WEBLAB_FOOTER_HEIGHT=void 0;var i=n(1),r=o(i),s=n(32),l=o(s),a=n(1295),u=o(a),c=n(3367),d=o(c),p=n(53),f=n(2965),h=o(f),b=n(1923),m=n(594),P=o(m),g=n(3368),v=o(g),y=n(2966),w=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(y),F=n(745),S=o(F),E=n(237),I=n(216),C=n(753),_=n(728).files,O=n(1289),R=(t.WEBLAB_FOOTER_HEIGHT=30,null),A=function(){this.skin=null,this.level=null,this.studioApp_=null,u.default.setLogMethod(this.log.bind(this)),R=this};A.prototype.log=function(e){this.consoleLogger_.log(e)},A.prototype.injectStudioApp=function(e){this.studioApp_=e,this.studioApp_.reset=this.reset.bind(this)},window.getWebLab=function(){return R},A.prototype.init=function(e){function t(){this.brambleHost.addFileHTML()}function n(){this.brambleHost.addFileCSS()}function o(){var t=this;S.default.autosave(function(){dashboard.assets.showAssetManager(null,"image",t.loadFileEntries.bind(t),{showUnderageWarning:!(0,E.getStore)().getState().pageConstants.is13Plus,useFilesApi:e.useFilesApi})})}function i(){this.brambleHost.undo()}function s(){this.brambleHost.redo()}function a(){var e=this;S.default.autosave(function(){e.brambleHost.refreshPreview()})}function u(){var e=this;this.brambleHost.enableFullscreenPreview(function(){(0,E.getStore)().getState().inspectorOn&&e.brambleHost.disableInspector(),(0,E.getStore)().dispatch(w.changeFullScreenPreviewOn(!0))})}function c(){this.brambleHost.disableFullscreenPreview(function(){(0,E.getStore)().dispatch(w.changeFullScreenPreviewOn(!1))})}function f(){(0,E.getStore)().getState().inspectorOn?this.brambleHost.disableInspector():this.brambleHost.enableInspector()}var m=this;if(!this.studioApp_)throw new Error("WebLab requires a StudioApp");if(this.skin=e.skin,this.level=e.level,this.suppliedFilesVersionId=(0,C.queryParams)("version"),this.initialFilesVersionId=this.suppliedFilesVersionId,this.brambleHost=null,this.level.startSources&&this.level.startSources.length>0)try{this.startSources=JSON.parse(this.level.startSources)}catch(e){console.error("Unable to parse startSources list",e)}e.usesAssets=!0,e.makeYourOwn=!1,e.centerEmbedded=!1,e.wireframeShare=!0,e.noHowItWorks=!0,e.afterClearPuzzle=function(e){return new Promise(function(e,t){_.deleteAll(function(n,o){m.fileEntries=null,m.brambleHost.startInitialFileSync(function(n){n?t(n):e()},!0)},function(e){console.warn("WebLab: error deleteAll failed: "+e.status),t(new Error(e.status))})})},e.getCodeAsync=this.getCodeAsync.bind(this),e.prepareForRemix=this.prepareForRemix.bind(this),e.noInstructionsWhenCollapsed=!0,e.pinWorkspaceToBottom=!0,e.useFilesApi=!0,this.loadFileEntries();var g=function(){m.setupReduxSubscribers((0,E.getStore)()),m.studioApp_.setConfigValues_(e);var t=document.getElementById(e.containerId),n=document.body;n.style.overflow="hidden",n.className=n.className+" pin_bottom",t.className=t.className+" pin_bottom",m.studioApp_.initProjectTemplateWorkspaceIconCallout(),m.studioApp_.alertIfCompletedWhilePairing(e),m.studioApp_.initVersionHistoryUI(e);var o=document.getElementById("finishButton");o&&P.default.addClickTouchEvent(o,m.onFinish.bind(m,!1)),(0,b.initializeSubmitHelper)({studioApp:m.studioApp_,onPuzzleComplete:m.onFinish.bind(m),unsubmitUrl:m.level.unsubmitUrl})};this.studioApp_.setPageConstants(e,{channelId:e.channel,noVisualization:!0,visualizationInWorkspace:!0,documentationUrl:"https://docs.code.org/weblab/",isProjectLevel:!!e.level.isProjectLevel,isSubmittable:!!e.level.submittable,isSubmitted:!!e.level.submitted}),this.readOnly=e.readonlyWorkspace,l.default.render(r.default.createElement(p.Provider,{store:(0,E.getStore)()},r.default.createElement(d.default,{onAddFileHTML:t.bind(this),onAddFileCSS:n.bind(this),onAddFileImage:o.bind(this),onUndo:i.bind(this),onRedo:s.bind(this),onRefreshPreview:a.bind(this),onStartFullScreenPreview:u.bind(this),onEndFullScreenPreview:c.bind(this),onToggleInspector:f.bind(this),onMount:g})),document.getElementById(e.containerId)),window.onbeforeunload=function(e){if(S.default.hasOwnerChangedProject())return h.default.confirmExitWithUnsavedChanges()}},A.prototype.onFinish=function(e){var t=this,n=e?b.onSubmitComplete:this.studioApp_.onContinue.bind(this.studioApp_);S.default.autosave(function(){t.studioApp_.report({app:"weblab",level:t.level.id,result:!0,testResult:I.TestResults.FREE_PLAY,program:t.getCurrentFilesVersionId()||"",submitted:e,onComplete:n})})},A.prototype.getCodeAsync=function(){var e=this;return new Promise(function(t,n){null!==e.brambleHost?e.brambleHost.syncFiles(function(n){t(e.getCurrentFilesVersionId()||"")}):t("")})},A.prototype.prepareForRemix=function(){return new Promise(function(e,t){_.prepareForRemix(e)})},A.prototype.getStartSources=function(){return this.startSources},A.prototype.getCurrentFileEntries=function(){return this.fileEntries},A.prototype.getCurrentFilesVersionId=function(){return S.default.filesVersionId||this.initialFilesVersionId},A.prototype.deleteProjectFile=function(e,t){_.deleteFile(e,function(e){t(null,S.default.filesVersionId)},function(n){console.warn("WebLab: error file "+e+" not deleted"),t(new Error(n.status))})},A.prototype.renameProjectFile=function(e,t,n){_.renameFile(e,t,function(e){n(null,S.default.filesVersionId)},function(t){console.warn("WebLab: error file "+e+" not renamed"),n(new Error(t.status))})},A.prototype.changeProjectFile=function(e,t,n){_.putFile(e,t,function(e){n(null,S.default.filesVersionId)},function(t){console.warn("WebLab: error file "+e+" not renamed"),n(new Error(t.status))})},A.prototype.registerBeforeFirstWriteHook=function(e){_.registerBeforeFirstWriteHook(e)},A.prototype.onProjectChanged=function(){this.readOnly||S.default.projectChanged()},A.prototype.onInspectorChanged=function(e){(0,E.getStore)().dispatch(w.changeInspectorOn(e))},A.prototype.setBrambleHost=function(e){return this.brambleHost=e,this.brambleHost.onBrambleReady(function(){var e=document.getElementById("share-cell");e&&(e.className="share-cell-enabled")}),this.brambleHost.onProjectChanged(this.onProjectChanged.bind(this)),this.brambleHost.onInspectorChanged(this.onInspectorChanged.bind(this)),this.suppliedFilesVersionId?S.default.getCurrentId()+"-"+this.suppliedFilesVersionId:S.default.getCurrentId()},A.prototype.getPageConstants=function(){return(0,E.getStore)().getState().pageConstants},A.prototype.setupReduxSubscribers=function(e){var t=this,n={};e.subscribe(function(){var o=n;n=e.getState(),o.runState&&n.runState.isRunning===o.runState.isRunning||t.onIsRunningChange(n.runState.isRunning)})},A.prototype.onIsRunningChange=function(){},A.prototype.loadFileEntries=function(){var e=this;_.getFiles(function(t){O.reset(t.files),e.fileEntries=O.list().map(function(e){return{name:e.filename,url:_.basePath(e.filename),versionId:e.versionId}});var n=t.filesVersionId;e.initialFilesVersionId=e.initialFilesVersionId||n,n!==e.initialFilesVersionId&&(S.default.filesVersionId=t.filesVersionId),e.brambleHost&&e.brambleHost.syncFiles(function(){})},function(t){console.error("files API failed, status: "+t.status),e.fileEntries=null},this.getCurrentFilesVersionId())},A.prototype.reset=function(e){},A.prototype.getAppReducers=function(){return v.default},t.default=A},3367:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=n(1),a=o(l),u=n(53),c=n(1294),d=o(c),p=n(1689),f=o(p),h=n(40),b=o(h),m=n(2965),P=o(m),g=n(915),v=o(g),y=n(1688),w=o(y),F=n(1728),S=o(F),E=n(593),I=o(E),C=function(e){function t(){return i(this,t),r(this,e.apply(this,arguments))}return s(t,e),t.prototype.componentDidMount=function(){this.props.onMount()},t.prototype.render=function(){var e=I.default["workspace-headers-height"],t=e+(this.props.isProjectLevel?0:70),n={position:"absolute",width:"100%",height:"calc(100% - "+t+"px)"};return a.default.createElement(d.default,null,a.default.createElement(f.default,null,a.default.createElement("div",null,a.default.createElement(v.default,{hasFocus:!0,id:"headers"},!this.props.isFullScreenPreviewOn&&!this.props.isReadOnlyWorkspace&&a.default.createElement("div",null,a.default.createElement(g.PaneButton,{iconClass:"fa fa-plus-circle",leftJustified:!0,headerHasFocus:!0,isRtl:!1,onClick:this.props.onAddFileHTML,label:P.default.addHTMLButton()}),a.default.createElement(g.PaneButton,{iconClass:"fa fa-plus-circle",leftJustified:!0,headerHasFocus:!0,isRtl:!1,onClick:this.props.onAddFileCSS,label:P.default.addCSSButton()}),a.default.createElement(g.PaneButton,{iconClass:"fa fa-plus-circle",leftJustified:!0,headerHasFocus:!0,isRtl:!1,onClick:this.props.onAddFileImage,label:P.default.addImageButton()})),a.default.createElement("div",null,a.default.createElement(g.PaneButton,{iconClass:this.props.isFullScreenPreviewOn?"fa fa-compress":"fa fa-arrows-alt",leftJustified:!1,headerHasFocus:!0,isRtl:!1,onClick:this.props.isFullScreenPreviewOn?this.props.onEndFullScreenPreview:this.props.onStartFullScreenPreview,label:""}),!this.props.isFullScreenPreviewOn&&!this.props.isReadOnlyWorkspace&&a.default.createElement("div",null,a.default.createElement(g.PaneButton,{id:"versions-header",iconClass:"fa fa-clock-o",leftJustified:!0,headerHasFocus:!0,isRtl:!1,label:b.default.showVersionsHeader()}),a.default.createElement(g.PaneButton,{iconClass:"fa fa-repeat",leftJustified:!1,headerHasFocus:!0,isRtl:!1,onClick:this.props.onRefreshPreview,label:P.default.refreshPreview()})),!this.props.isFullScreenPreviewOn&&a.default.createElement(g.PaneButton,{iconClass:"fa fa-mouse-pointer",leftJustified:!1,headerHasFocus:!0,isPressed:this.props.isInspectorOn,pressedLabel:P.default.toggleInspectorOff(),isRtl:!1,onClick:this.props.onToggleInspector,label:P.default.toggleInspectorOn()}),a.default.createElement(g.PaneSection,{id:"workspace-header"},this.props.showProjectTemplateWorkspaceIcon&&a.default.createElement(S.default,null),this.props.isReadOnlyWorkspace&&a.default.createElement("span",{id:"workspace-header-span"},b.default.readonlyWorkspaceHeader())))),a.default.createElement("iframe",{className:"weblab-host",src:"/weblab/host",frameBorder:"0",scrolling:"no",style:n}),!this.props.isProjectLevel&&a.default.createElement(w.default,null))))},t}(a.default.Component);C.propTypes={isProjectLevel:l.PropTypes.bool.isRequired,isReadOnlyWorkspace:l.PropTypes.bool.isRequired,isInspectorOn:l.PropTypes.bool.isRequired,isFullScreenPreviewOn:l.PropTypes.bool.isRequired,onUndo:l.PropTypes.func.isRequired,onRedo:l.PropTypes.func.isRequired,onRefreshPreview:l.PropTypes.func.isRequired,onStartFullScreenPreview:l.PropTypes.func.isRequired,onEndFullScreenPreview:l.PropTypes.func.isRequired,onToggleInspector:l.PropTypes.func.isRequired,onAddFileHTML:l.PropTypes.func.isRequired,onAddFileCSS:l.PropTypes.func.isRequired,onAddFileImage:l.PropTypes.func.isRequired,onMount:l.PropTypes.func.isRequired,showProjectTemplateWorkspaceIcon:l.PropTypes.bool.isRequired},t.default=(0,u.connect)(function(e){return{isProjectLevel:e.pageConstants.isProjectLevel,isReadOnlyWorkspace:e.pageConstants.isReadOnlyWorkspace,isInspectorOn:e.inspectorOn,isFullScreenPreviewOn:e.fullScreenPreviewOn,showProjectTemplateWorkspaceIcon:!!e.pageConstants.showProjectTemplateWorkspaceIcon}})(C),e.exports=t.default},3368:function(e,t,n){"use strict";function o(e,t){switch(e=e||!1,t.type){case r.ActionType.CHANGE_FULL_SCREEN_PREVIEW_ON:return t.fullScreenPreviewOn;default:return e}}function i(e,t){switch(e=e||!1,t.type){case r.ActionType.CHANGE_INSPECTOR_ON:return t.inspectorOn;default:return e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2966);t.default={fullScreenPreviewOn:o,inspectorOn:i},e.exports=t.default},3369:function(e,t,n){"use strict";(e.exports={}).custom={}}},[3363]);